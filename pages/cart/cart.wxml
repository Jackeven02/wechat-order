<!-- pages/cart/cart.wxml -->
<view class="container">
  <!-- 购物车为空状态 -->
  <view class="empty-cart" wx:if="{{cart.length === 0}}">
    <image class="empty-icon" src="https://picsum.photos/150/150?random=11"></image>
    <text class="empty-text">购物车空空如也</text>
    <text class="empty-subtext">快去挑选美味菜品吧</text>
    <button class="go-menu-btn" bindtap="onBackToMenu">去点餐</button>
  </view>

  <!-- 购物车有商品 -->
  <view class="cart-content" wx:else>
    <!-- 桌台信息 -->
    <view class="table-info-card" wx:if="{{tableInfo}}">
      <view class="table-row">
        <view class="table-info-left">
          <text class="table-label">当前桌台：</text>
          <text class="table-number">{{tableInfo.tableNumber}}</text>
        </view>
        <view class="table-status">
          <text class="status-text {{tableInfo.status === 'available' ? 'status-green' : 'status-orange'}}">
            {{tableInfo.status === 'available' ? '空闲' : tableInfo.status === 'ordering' ? '点餐中' : '用餐中'}}
          </text>
        </view>
      </view>
    </view>

    <!-- 未绑定桌台提示 -->
    <view class="no-table-tip" wx:else>
      <text class="tip-text">请先绑定桌台才能下单</text>
      <button class="bind-table-btn" bindtap="onBackToMenu">去绑定</button>
    </view>

    <!-- 购物车列表 -->
    <view class="cart-list">
      <!-- 全选区域 -->
      <view class="select-all">
        <view class="left-controls">
          <view class="checkbox-container" bindtap="onSelectAll">
            <view class="checkbox {{selectedItems.length === cart.length && cart.length > 0 ? 'checked' : ''}}">
              <text class="checkmark" wx:if="{{selectedItems.length === cart.length && cart.length > 0}}">✓</text>
            </view>
            <text class="select-text">全选</text>
          </view>
        </view>
        <view class="right-controls">
          <button class="clear-btn" bindtap="onClearCart">清空</button>
        </view>
      </view>

      <!-- 商品列表 -->
      <view class="cart-items">
        <block wx:for="{{processedCart}}" wx:key="dishId">
          <view class="cart-item">
            <!-- 选择框 -->
            <view class="checkbox-container" bindtap="onItemSelect" data-dishid="{{item.dishId}}">
              <view class="checkbox {{item.isSelected ? 'checked' : ''}}">
                <text class="checkmark" wx:if="{{item.isSelected}}">✓</text>
              </view>
            </view>

            <!-- 商品图片 -->
            <view class="item-image">
              <image class="dish-img" src="{{item.image}}" mode="aspectFill"></image>
            </view>

            <!-- 商品信息和操作区 -->
            <view class="item-content">
              <!-- 商品信息 -->
              <view class="item-info">
                <text class="dish-name">{{item.name}}</text>
                <text class="dish-price">¥{{item.formattedPrice}}</text>
              </view>
              
              <!-- 操作区域 -->
              <view class="item-actions">
                <!-- 数量控制 -->
                <view class="quantity-control">
                  <button class="qty-btn minus" bindtap="onDecrease" data-index="{{index}}">-</button>
                  <text class="qty-num">{{item.quantity}}</text>
                  <button class="qty-btn plus" bindtap="onIncrease" data-index="{{index}}">+</button>
                </view>
              </view>
            </view>
          </view>
        </block>
      </view>
    </view>

    <!-- 底部结算栏 -->
    <view class="checkout-bar">
      <view class="checkout-info">
        <view class="total-info">
          <text class="total-label">合计：</text>
          <text class="total-amount">¥{{formattedTotalPrice}}</text>
        </view>
        <text class="selected-count">已选{{selectedItems.length}}件商品</text>
      </view>
      
      <button 
        class="checkout-btn {{selectedItems.length > 0 ? '' : 'disabled'}}" 
        bindtap="onSubmitOrder"
        disabled="{{selectedItems.length === 0}}">
        {{selectedItems.length > 0 ? '去结算' : '请选择商品'}}
      </button>
    </view>
  </view>

  <!-- 备注弹窗 -->
  <view class="modal" wx:if="{{showRemarkModal}}" bindtap="onCancelRemark">
    <view class="modal-content" bindtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">添加备注</text>
      </view>
      <view class="modal-body">
        <textarea 
          class="remark-input" 
          placeholder="请输入特殊要求，如：少辣、不要香菜等"
          value="{{remarkContent}}"
          bindinput="onRemarkInput"
          maxlength="100"
          auto-height>
        </textarea>
        <text class="char-count">{{remarkContent.length}}/100</text>
      </view>
      <view class="modal-footer">
        <button class="modal-btn confirm" bindtap="onConfirmRemark">确定</button>
      </view>
    </view>
  </view>
</view>