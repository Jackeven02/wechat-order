<!-- pages/menu/menu.wxml -->
<view class="container">
  <!-- é¡¶éƒ¨æœç´¢æ  -->
  <view class="search-bar">
    <view class="search-container" wx:if="{{showSearch}}">
      <input 
        class="search-input" 
        placeholder="æœç´¢èœå“åç§°" 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        focus="{{showSearch}}"
      />
      <button class="search-cancel" bindtap="toggleSearch">å–æ¶ˆ</button>
    </view>
    <view class="search-placeholder" wx:else bindtap="toggleSearch">
      <text class="search-text">ğŸ” æœç´¢èœå“</text>
    </view>
  </view>

  <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
  <view class="main-content">
    <!-- åˆ†ç±»ä¾§è¾¹æ  -->
    <scroll-view class="category-sidebar" scroll-y>
      <block wx:for="{{categories}}" wx:key="id">
        <view 
          class="category-item {{activeCategory === index ? 'active' : ''}}" 
          bindtap="onCategorySelect" 
          data-index="{{index}}" 
          data-id="{{item.id}}">
          <image class="category-icon" src="{{item.icon}}" mode="aspectFit"></image>
          <text class="category-name">{{item.name}}</text>
          <text class="category-count" wx:if="{{item.dishCount}}">{{item.dishCount}}</text>
        </view>
      </block>
    </scroll-view>

    <!-- èœå“ä¸»åŒºåŸŸ -->
    <scroll-view class="dish-main" scroll-y>
      <!-- åŠ è½½çŠ¶æ€ -->
      <view class="loading" wx:if="{{isLoading}}">
        <view class="spinner"></view>
        <text>åŠ è½½ä¸­...</text>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:elif="{{filteredDishes.length === 0}}">
        <image class="empty-icon" src="https://picsum.photos/150/150?random=12"></image>
        <text class="empty-text">æš‚æ— ç›¸å…³èœå“</text>
      </view>

      <!-- èœå“åˆ—è¡¨ -->
      <view class="dish-list" wx:else>
        <block wx:for="{{filteredDishes}}" wx:key="id">
          <view class="dish-item" bindtap="onDishDetail" data-dish="{{item}}">
            <!-- èœå“å›¾ç‰‡ -->
            <view class="dish-image-container">
              <image class="dish-image" src="{{item.image}}" mode="aspectFill"></image>
              <view class="dish-badge" wx:if="{{item.isNew}}">æ–°å“</view>
              <view class="dish-badge hot" wx:elif="{{item.isHot}}">çƒ­é”€</view>
              <view class="dish-badge recommend" wx:elif="{{item.isRecommend}}">æ¨è</view>
            </view>

            <!-- èœå“ä¿¡æ¯ -->
            <view class="dish-info">
              <view class="dish-header">
                <text class="dish-name">{{item.name}}</text>
                <text class="dish-price">Â¥{{item.formattedPrice}}</text>
              </view>
              
              <text class="dish-description">{{item.description}}</text>
              
              <view class="dish-meta">
                <text class="dish-sales">å·²å”® {{item.salesCount}}</text>
                <text class="dish-rating" wx:if="{{item.rating}}">â­ {{item.rating}}</text>
                <text class="dish-stock {{item.stock <= 5 ? 'low-stock' : ''}}" wx:if="{{item.stock <= 10}}">
                  {{item.stock > 0 ? 'ä»…å‰©' + item.stock + 'ä»½' : 'å·²å”®ç½„'}}
                </text>
              </view>
            </view>

            <!-- æ“ä½œæŒ‰é’® -->
            <view class="dish-actions">
              <button 
                class="add-btn {{item.stock <= 0 ? 'disabled' : ''}}" 
                bindtap="onAddToCart" 
                data-dish="{{item}}"
                hover-class="add-btn-hover">
                +
              </button>
            </view>
          </view>
        </block>
      </view>
    </scroll-view>
  </view>

  <!-- è´­ç‰©è½¦æ‚¬æµ®æŒ‰é’® -->
  <view class="cart-float" bindtap="onCartPreview">
    <image class="cart-icon" src="https://picsum.photos/60/60?random=13"></image>
    <text class="cart-count" wx:if="{{cart.length > 0}}">{{cart.length}}</text>
  </view>

  <!-- åº•éƒ¨è´­ç‰©è½¦æ¦‚è§ˆ -->
  <view class="cart-summary" wx:if="{{cart.length > 0}}" bindtap="onCartPreview">
    <view class="cart-info">
      <text class="cart-total">å…±{{cart.length}}ä»¶å•†å“</text>
      <text class="cart-amount">Â¥{{formattedCartTotal}}</text>
    </view>
    <view class="cart-action">
      <text class="view-cart">æŸ¥çœ‹è´­ç‰©è½¦</text>
    </view>
  </view>
</view>