<!-- pages/order/order.wxml -->
<view class="container">
  <!-- 未登录状态 -->
  <view class="unlogin-state" wx:if="{{!isLogin}}">
    <image class="unlogin-icon" src="https://picsum.photos/100/100?random=9"></image>
    <text class="unlogin-text">请先登录查看订单</text>
    <button class="login-btn" bindtap="onGoToMenu">去登录</button>
  </view>

  <!-- 已登录状态 -->
  <view class="order-content" wx:else>
    <!-- 标签页 -->
    <view class="tab-bar">
      <block wx:for="{{tabs}}" wx:key="index">
        <view 
          class="tab-item {{activeTab === index ? 'active' : ''}}" 
          bindtap="onTabChange" 
          data-index="{{index}}">
          <text class="tab-text">{{item}}</text>
        </view>
      </block>
    </view>

    <!-- 订单列表 -->
    <scroll-view class="order-list" scroll-y>
      <!-- 空状态 -->
      <view class="empty-state" wx:if="{{orders.length === 0}}">
        <image class="empty-icon" src="https://picsum.photos/150/150?random=10"></image>
        <text class="empty-text">暂无订单</text>
        <text class="empty-subtext">快去点餐吧</text>
        <button class="go-menu-btn" bindtap="onGoToMenu">去点餐</button>
      </view>

      <!-- 订单列表 -->
      <view class="order-items" wx:else>
        <block wx:for="{{orders}}" wx:key="id">
          <view class="order-item">
            <!-- 订单头部 -->
            <view class="order-header">
              <view class="order-basic">
                <text class="order-number">订单号：{{item.orderNumber}}</text>
                <text class="order-time">{{item.createTime}}</text>
              </view>
              <text class="order-status {{getStatusClass(item.status)}}">
                {{getStatusText(item.status)}}
              </text>
            </view>

            <!-- 桌台信息 -->
            <view class="table-info">
              <text class="table-label">桌台：</text>
              <text class="table-number">{{item.tableNumber}}</text>
            </view>

            <!-- 商品列表 -->
            <view class="order-dishes">
              <block wx:for="{{item.items}}" wx:key="dishId">
                <view class="dish-item">
                  <text class="dish-name">{{item.name}}</text>
                  <view class="dish-info">
                    <text class="dish-price">¥{{item.formattedPrice}}</text>
                    <text class="dish-quantity">×{{item.quantity}}</text>
                  </view>
                </view>
              </block>
            </view>

            <!-- 订单金额 -->
            <view class="order-amount">
              <text class="amount-label">实付：</text>
              <text class="amount-value">¥{{item.formattedTotalAmount}}</text>
            </view>

            <!-- 操作按钮 -->
            <view class="order-actions">
              <button 
                class="action-btn detail" 
                bindtap="onViewOrder" 
                data-id="{{item.id}}">
                查看详情
              </button>
              <button 
                class="action-btn cancel" 
                bindtap="onCancelOrder" 
                data-id="{{item.id}}"
                wx:if="{{canCancelOrder(item.status)}}">
                取消订单
              </button>
            </view>
          </view>
        </block>
      </view>
    </scroll-view>
  </view>
</view>