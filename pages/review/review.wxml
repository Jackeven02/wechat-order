<!-- pages/review/review.wxml -->
<view class="container">
  <!-- 订单信息 -->
  <view class="order-info" wx:if="{{orderInfo}}">
    <view class="order-header">
      <text class="order-number">订单号：{{orderInfo.orderNumber}}</text>
      <text class="order-time">{{orderInfo.createTime}}</text>
    </view>
    <scroll-view class="order-items" scroll-y>
      <block wx:for="{{orderInfo.items}}" wx:key="id">
        <view class="order-item">
          <image class="item-image" src="{{item.image}}" mode="aspectFill"></image>
          <text class="item-name">{{item.name}}</text>
          <text class="item-price">¥{{item.formattedPrice}}</text>
        </view>
      </block>
    </scroll-view>
  </view>

  <!-- 评分区域 -->
  <view class="rating-section">
    <view class="section-title">请为本次用餐体验打分</view>
    <view class="rating-stars">
      <block wx:for="{{[1,2,3,4,5]}}" wx:key="index">
        <text 
          class="star {{index < rating ? 'active' : ''}}" 
          bindtap="onRatingChange" 
          data-rating="{{index + 1}}"
        >
          ★
        </text>
      </block>
    </view>
    <view class="rating-label">{{ratingLabels[rating-1]}}</view>
  </view>

  <!-- 评论区域 -->
  <view class="comment-section">
    <view class="section-title">写下您的用餐体验</view>
    <textarea 
      class="comment-textarea" 
      placeholder="请分享您的用餐体验，帮助我们改进服务..."
      value="{{comment}}"
      bindinput="onCommentInput"
      maxlength="500"
    ></textarea>
  </view>

  <!-- 图片上传区域 -->
  <view class="image-section">
    <view class="section-title">上传菜品图片（可选）</view>
    <view class="image-upload">
      <block wx:for="{{images}}" wx:key="index">
        <view class="uploaded-image">
          <image 
            class="image-preview" 
            src="{{item}}" 
            mode="aspectFill"
            bindtap="onPreviewImage"
            data-src="{{item}}"
          ></image>
          <view class="delete-btn" bindtap="onDeleteImage" data-index="{{index}}">×</view>
        </view>
      </block>
      <view class="upload-btn" wx:if="{{images.length < 3}}" bindtap="onChooseImage">
        <text class="upload-icon">+</text>
        <text>添加图片</text>
      </view>
    </view>
  </view>

  <!-- 提交按钮 -->
  <view class="submit-section">
    <button 
      class="submit-btn" 
      bindtap="onSubmitReview" 
      disabled="{{isSubmitting}}"
    >
      {{isSubmitting ? '提交中...' : '提交评价'}}
    </button>
  </view>
</view>